!function(t){"use strict";var e=t.tablesorter,i=e.output={event:"outputTable",regexQuote:/([\n\t]|<[^<]+>)/,regexBR:/(<br([\s\/])?>|\n)/g,regexIMG:/<img[^>]+alt\s*=\s*['"]([^'"]+)['"][^>]*>/i,regexHTML:/<[^<]+>/g,replaceCR:"\\n",replaceTab:"\\t",popupTitle:"Output",popupStyle:"width:100%;height:100%;",message:"Your device does not support downloading. Please try again in desktop browser.",init:function(t){t.$table.off(i.event).on(i.event,function(){i.process(t,t.widgetOptions)})},processRow:function(e,s,n,r){var o,a,l,h,c,d,u=e.widgetOptions,p=[],f=u.output_duplicateSpans,g=n&&r&&u.output_headerRows&&t.isFunction(u.output_callbackJSON),m=0;return s.each(function(e){p[e]||(p[e]=[]),m=0,t(this).children().each(function(){if(o=t(this),o.filter("[rowspan]").length)for(h=parseInt(o.attr("rowspan"),10)-1,d=i.formatData(u,o.attr(u.output_dataAttrib)||o.html(),n),a=1;h>=a;a++)p[e+a]||(p[e+a]=[]),p[e+a][m]=n?d:f?d:"";if(o.filter("[colspan]").length)for(c=parseInt(o.attr("colspan"),10)-1,d=i.formatData(u,o.attr(u.output_dataAttrib)||o.html(),n),l=1;c>=l;l++)if(o.filter("[rowspan]").length)for(h=parseInt(o.attr("rowspan"),10),a=0;h>a;a++)p[e+a]||(p[e+a]=[]),p[e+a][m+l]=g?u.output_callbackJSON(o,d,m+l)||d+"("+(m+l)+")":n?d:f?d:"";else p[e][m+l]=g?u.output_callbackJSON(o,d,m+l)||d+"("+(m+l)+")":n?d:f?d:"";if("none"!==o.css("display")){for(;"undefined"!=typeof p[e][m];)m++;p[e][m]=p[e][m]||i.formatData(u,o.attr(u.output_dataAttrib)||o.html(),n),m++}})}),p},ignoreColumns:function(e,i){return t.each(i,function(s,n){i[s]=t.grep(n,function(i,s){return t.inArray(s,e.output_ignoreColumns)<0})}),i},process:function(s,n){var r,o,a,l,h,c,d=window.JSON&&JSON.hasOwnProperty("stringify"),u=0,p=(n.output_separator||",").toLowerCase(),f="json"===p,g="array"===p,m=f||g?",":n.output_separator,v=s.$table;n.output_regex=new RegExp("("+(/\\/.test(m)?"\\":"")+m+")"),o=v.find("thead tr:visible").not("."+(e.css.filterRow||"tablesorter-filter-row")),l=i.processRow(s,o,!0,f),a=v.children("tbody").children("tr"),a=/f/.test(n.output_saveRows)?a.not("."+(n.filter_filteredRow||"filtered")):/v/.test(n.output_saveRows)?a.filter(":visible"):a,h=i.processRow(s,a),c=l.length,n.output_ignoreColumns.length&&(l=i.ignoreColumns(n,l),h=i.ignoreColumns(n,h)),f?(p=[],t.each(h,function(t,e){p.push(i.row2Hash(l[c>1&&n.output_headerRows?t%c:c-1],e))}),r=d?JSON.stringify(p):p):(p=i.row2CSV(n,n.output_headerRows?l:[l[c>1&&n.output_headerRows?u%c:c-1]],g).concat(i.row2CSV(n,h,g)),r=g&&d?JSON.stringify(p):p.join("\n")),(!t.isFunction(n.output_callback)||n.output_callback(s,r))&&(/p/.test((n.output_delivery||"").toLowerCase())?i.popup(r,n.output_popupStyle,f||g):i.download(n,r))},row2CSV:function(t,e,i){var s,n,r=[],o=e.length;for(n=0;o>n;n++)s=e[n].join("").replace(/\"/g,""),e[n].length>0&&""!==s&&(r[r.length]=i?e[n]:e[n].join(t.output_separator));return r},row2Hash:function(e,i){var s={};return t.each(i,function(t,i){t<e.length&&(s[e[t]]=i)}),s},formatData:function(e,s,n){var r,o=(e.output_separator||",").toLowerCase(),a="json"===o||"array"===o,l=s.replace(/\"/g,e.output_replaceQuote||"\u201c");return l=l.replace(i.regexBR,i.replaceCR).replace(/\t/g,i.replaceTab),r=l.match(i.regexIMG),e.output_includeHTML||null===r||(l=r[1]),l=e.output_includeHTML&&!n?l:l.replace(i.regexHTML,""),l=e.output_trimSpaces||n?t.trim(l):l,o=a?!1:e.output_wrapQuotes||e.output_regex.test(l)||i.regexQuote.test(l),o?'"'+l+'"':l},popup:function(t,e,s){var n=window.open("",i.popupTitle,e);return n.document.write("<html><head><title>"+i.popupTitle+'</title></head><body><textarea wrap="'+(s?"on":"off")+'" style="'+i.popupStyle+'">'+t+"\n</textarea></body></html>"),n.document.close(),n.focus(),!0},download:function(t,e){var s,n,r,o=window.navigator,a=document.createElement("a");if(/(iP)/g.test(o.userAgent))return alert(i.message),!1;try{r=!!new Blob}catch(l){r=!1}return r?(window.URL=window.webkitURL||window.URL,n=new Blob([e],{type:t.output_encoding}),o.msSaveBlob?o.msSaveBlob(n,t.output_saveFileName):(a.href=window.URL.createObjectURL(n),a.download=t.output_saveFileName,document.createEvent&&(s=document.createEvent("MouseEvents"),s.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),a.dispatchEvent(s))),!1):(window.open(t.output_encoding+encodeURIComponent(e)+"?download","_self"),!0)},remove:function(t){t.$table.off(i.event)}};e.addWidget({id:"output",options:{output_separator:",",output_ignoreColumns:[],output_dataAttrib:"data-name",output_headerRows:!1,output_delivery:"popup",output_saveRows:"filtered",output_duplicateSpans:!0,output_replaceQuote:"\u201c;",output_includeHTML:!1,output_trimSpaces:!0,output_wrapQuotes:!1,output_popupStyle:"width=500,height=300",output_saveFileName:"mytable.csv",output_callback:function(){return!0},output_callbackJSON:function(t,e,i){return e+"("+i+")"},output_encoding:"data:application/octet-stream;charset=utf8,"},init:function(t,e,s){i.init(s)},remove:function(t,e){i.remove(e)}})}(jQuery);