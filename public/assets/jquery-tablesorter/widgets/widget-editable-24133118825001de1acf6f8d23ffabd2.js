!function(t){"use strict";t.tablesorter.addWidget({id:"editable",options:{editable_columns:[],editable_enterToAccept:!0,editable_autoAccept:!0,editable_autoResort:!1,editable_validate:null,editable_noEdit:"no-edit",editable_editComplete:"editComplete"},init:function(e,i,s,n){if(n.editable_columns.length){var r,a,o,l=[];if("string"===t.type(n.editable_columns)&&n.editable_columns.indexOf("-")>=0)for(a=n.editable_columns.split("-"),r=parseInt(a[0],10)||0,a=parseInt(a[1],10)||s.columns-1,a>s.columns&&(a=s.columns-1);a>=r;r++)l.push("td:nth-child("+(r+1)+")");else t.isArray(n.editable_columns)&&t.each(n.editable_columns,function(t,e){e<s.columns&&l.push("td:nth-child("+(e+1)+")")});s.$tbodies.find(l.join(",")).not("."+n.editable_noEdit).each(function(){o=t(this),(o.children().length?o.children():o).prop("contenteditable",!0)}),s.$tbodies.on("mouseleave.tseditable",function(){s.$table.data("contentFocused")&&(s.$table.data("contentFocused",!0),t(":focus").trigger("blur"))}).on("focus.tseditable","[contenteditable]",function(e){s.$table.data("contentFocused",e.target);var i=t(this),r=i.html();n.editable_enterToAccept&&i.on("keydown.tseditable",function(t){13===t.which&&t.preventDefault()}),i.data({before:r,original:r})}).on("blur focusout keydown ".split(" ").join(".tseditable "),"[contenteditable]",function(e){if(s.$table.data("contentFocused")){var i,r=!1,a=t(e.target);return 27===e.which?(a.html(a.data("original")).trigger("blur.tseditable"),s.$table.data("contentFocused",!1),!1):(i=13===e.which&&(n.editable_enterToAccept||e.altKey)||n.editable_autoAccept&&"keydown"!==e.type,i&&a.data("before")!==a.html()&&(r=t.isFunction(n.editable_validate)?n.editable_validate(a.html(),a.data("original")):a.html(),i&&r!==!1)?(a.html(r).data("before",r).trigger("change"),s.$table.trigger("updateCell",[a.closest("td"),n.editable_autoResort,function(){a.trigger(n.editable_editComplete,[s]),a.data("original",a.html()),n.editable_autoResort&&s.sortList.length&&s.$table.trigger("applyWidgets"),setTimeout(function(){var t=s.$table.data("contentFocused");t instanceof HTMLElement&&t.focus()},50)}]),!1):void(r||"keydown"===e.type||a.html(a.data("original"))))}})}}})}(jQuery);